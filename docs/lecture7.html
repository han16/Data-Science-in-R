<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Shengtong" />

<meta name="date" content="2018-11-06" />

<title>lecture7</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.0.13/css/fa-svg-with-js.css" rel="stylesheet" />
<script src="site_libs/font-awesome-5.0.13/js/fontawesome-all.min.js"></script>
<script src="site_libs/font-awesome-5.0.13/js/fa-v4-shims.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://han16.github.io/Data-Science-in-R/">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">lecture7</h1>
<h4 class="author"><em>Shengtong</em></h4>
<h4 class="date"><em>2018-11-06</em></h4>

</div>


<p><strong>Last updated:</strong> 2018-11-06</p>
<strong>workflowr checks:</strong> <small>(Click a bullet for more information)</small>
<ul>
<li>
<p><details> <summary> <strong style="color:blue;">✔</strong> <strong>R Markdown file:</strong> up-to-date </summary></p>
<p>Great! Since the R Markdown file has been committed to the Git repository, you know the exact version of the code that produced these results.</p>
</details>
</li>
<li>
<p><details> <summary> <strong style="color:blue;">✔</strong> <strong>Environment:</strong> empty </summary></p>
<p>Great job! The global environment was empty. Objects defined in the global environment can affect the analysis in your R Markdown file in unknown ways. For reproduciblity it’s best to always run the code in an empty environment.</p>
</details>
</li>
<li>
<p><details> <summary> <strong style="color:blue;">✔</strong> <strong>Seed:</strong> <code>set.seed(20181026)</code> </summary></p>
<p>The command <code>set.seed(20181026)</code> was run prior to running the code in the R Markdown file. Setting a seed ensures that any results that rely on randomness, e.g. subsampling or permutations, are reproducible.</p>
</details>
</li>
<li>
<p><details> <summary> <strong style="color:blue;">✔</strong> <strong>Session information:</strong> recorded </summary></p>
<p>Great job! Recording the operating system, R version, and package versions is critical for reproducibility.</p>
</details>
</li>
<li>
<p><details> <summary> <strong style="color:blue;">✔</strong> <strong>Repository version:</strong> <a href="https://github.com/han16/Data-Science-in-R/tree/43c8686867d5fd189a1aac98b3cf93262f8058d9" target="_blank">43c8686</a> </summary></p>
Great! You are using Git for version control. Tracking code development and connecting the code version to the results is critical for reproducibility. The version displayed above was the version of the Git repository at the time these results were generated. <br><br> Note that you need to be careful to ensure that all relevant files for the analysis have been committed to Git prior to generating the results (you can use <code>wflow_publish</code> or <code>wflow_git_commit</code>). workflowr only checks the R Markdown file, but you know if there are other scripts or data files that it depends on. Below is the status of the Git repository when the results were generated:
<pre><code>
Ignored files:
    Ignored:    .DS_Store
    Ignored:    .RData
    Ignored:    .Rhistory
    Ignored:    analysis/.DS_Store
    Ignored:    analysis/.Rapp.history
    Ignored:    analysis/.Rhistory

</code></pre>
Note that any generated files, e.g. HTML, png, CSS, etc., are not included in this status report because it is ok for generated content to have uncommitted changes. </details>
</li>
</ul>
<details> <summary> <small><strong>Expand here to see past versions:</strong></small> </summary>
<ul>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
File
</th>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
<th style="text-align:left;">
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Rmd
</td>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/analysis/lecture7.Rmd" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
<td style="text-align:left;">
Nov62018
</td>
</tr>
<tr>
<td style="text-align:left;">
html
</td>
<td style="text-align:left;">
<a href="https://cdn.rawgit.com/han16/Data-Science-in-R/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/lecture7.html" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
<td style="text-align:left;">
Nov62018
</td>
</tr>
<tr>
<td style="text-align:left;">
Rmd
</td>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/6dcf86a9d20b478879a3944301a1e51fec69a8cf/analysis/lecture7.Rmd" target="_blank">6dcf86a</a>
</td>
<td style="text-align:left;">
han16
</td>
<td style="text-align:left;">
2018-11-06
</td>
<td style="text-align:left;">
Nov62018
</td>
</tr>
</tbody>
</table>
</ul>
<p></details></p>
<hr />
<pre class="r"><code>#knitr::opts_chunk$set(echo = TRUE)
#knitr::read_chunk(&quot;chunks.R&quot;)
library(tidyverse)</code></pre>
<pre><code>── Attaching packages ─────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>✔ ggplot2 3.1.0     ✔ purrr   0.2.5
✔ tibble  1.4.2     ✔ dplyr   0.7.7
✔ tidyr   0.8.2     ✔ stringr 1.3.1
✔ readr   1.1.1     ✔ forcats 0.3.0</code></pre>
<pre><code>── Conflicts ────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>########################################################
#### Go over HW 4
####
#### Review for midterm (next Monday!)
#### Read Chapter 23 from http://r4ds.had.co.nz/index.html.
#### Read http://sjspielman.org/bio5312_fall2017/files/lm_supplement.pdf
####
#### Any questions from last week? 
#### {factors, ggplot2 color, dplyr, tidy data, relational data}
######################################################

#-------------------------------------------------------------
## In class warm-up to review tidy data:
#-------------------------------------------------------------

library(tidyverse)
#library(rcfss)
#data(dadmom) ## Note: this does not work for R 3.3.1
dadmom %&gt;% 
  gather(key=parent, value=income, -famid, -named, -namem) %&gt;%
  mutate(new_parent = ifelse(parent == &quot;incd&quot;, &quot;dad&quot;, &quot;mom&quot;)) %&gt;%
  mutate(name = ifelse(new_parent == &quot;dad&quot;, named, namem)) %&gt;%
  select(-named, -namem, -parent) %&gt;%
  arrange(income)

table2 %&gt;% spread(key=type, value=count) %&gt;%
  ## This next part goes back
  gather(key=type,value=count,cases:population)

## Tidy this dataframe (each variable should have its own column,
## each observation its own row, and each value its own cell)</code></pre>
<div id="correlation" class="section level2">
<h2>Correlation</h2>
<pre class="r"><code>#=============================================================
## Correlation
#=============================================================

## Measures strength and direction of the LINEAR association between
## two numeric variables (-1 &lt;= r &lt;= 1)

data(iris)
setosa &lt;- iris %&gt;% filter(Species == &quot;setosa&quot;)
#-------------------------------------------------------------
## Calculate the correlation between Sepal.Length and Sepal.Width
## in the setosa species, using both base R and dplyr.
## Plot the relationship between the two.
#-------------------------------------------------------------
#?cor
cor(setosa$Sepal.Length, setosa$Sepal.Width)</code></pre>
<pre><code>[1] 0.7425467</code></pre>
<pre class="r"><code>setosa %&gt;% summarize(correlation = cor(Sepal.Length, Sepal.Width))</code></pre>
<pre><code>  correlation
1   0.7425467</code></pre>
<pre class="r"><code>ggplot(setosa) + geom_point(aes(x=Sepal.Length, y=Sepal.Width))</code></pre>
<p><img src="figure/lecture7.Rmd/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;" /></p>
<details> <summary><em>Expand here to see past versions of unnamed-chunk-3-1.png:</em></summary>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/figure/lecture7.Rmd/unnamed-chunk-3-1.png" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
</tr>
</tbody>
</table>
<p></details></p>
<pre class="r"><code>## It is VERY important to visualize data!
## Correlations (and summary statistics in general) can be
## the same for VERY different distributions
install.packages(&quot;datasauRus&quot;)
library(datasauRus)
datasaurus_dozen %&gt;% filter(dataset == &quot;dino&quot;) %&gt;%
  summarize(cor = cor(x,y), sd_x = sd(x), sd_y = sd(y),
            mean_x = mean(x), mean_y = mean(y))
ggplot(datasaurus_dozen %&gt;% filter(dataset == &quot;dino&quot;)) +
  geom_point(aes(x, y)) + theme_bw()

datasaurus_dozen %&gt;% filter(dataset == &quot;bullseye&quot;) %&gt;%
  summarize(cor = cor(x,y), sd_x = sd(x), sd_y = sd(y),
            mean_x = mean(x), mean_y = mean(y))
ggplot(datasaurus_dozen %&gt;% filter(dataset == &quot;bullseye&quot;)) +
  geom_point(aes(x, y)) + theme_bw()
  
ggplot(datasaurus_dozen, aes(x = x, y = y, colour = dataset)) +
  geom_point() +
  theme_void() +
  theme(legend.position = &quot;none&quot;) +
  facet_wrap( ~ dataset, ncol = 3)</code></pre>
<pre class="r"><code>## Perfect positive correlation
x &lt;- rnorm(100)
y &lt;- x + 3
cor(x,y)</code></pre>
<pre><code>[1] 1</code></pre>
<pre class="r"><code>ggplot(data.frame(x=x,y=y), aes(x,y)) + geom_point()</code></pre>
<p><img src="figure/lecture7.Rmd/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;" /></p>
<details> <summary><em>Expand here to see past versions of unnamed-chunk-5-1.png:</em></summary>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/figure/lecture7.Rmd/unnamed-chunk-5-1.png" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
</tr>
</tbody>
</table>
<p></details></p>
<pre class="r"><code>## Perfect negative correlation
x &lt;- rnorm(100)
y &lt;- -2*x
cor(x,y)</code></pre>
<pre><code>[1] -1</code></pre>
<pre class="r"><code>ggplot(data.frame(x=x,y=y), aes(x,y)) + geom_point()</code></pre>
<p><img src="figure/lecture7.Rmd/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
<details> <summary><em>Expand here to see past versions of unnamed-chunk-6-1.png:</em></summary>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/figure/lecture7.Rmd/unnamed-chunk-6-1.png" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
</tr>
</tbody>
</table>
<p></details></p>
<pre class="r"><code>## Variability (error) has substantial influence
library(forcats)
x &lt;- rnorm(100)
y_low &lt;- -2 * x + rnorm(100, sd = 0.5)
y_med &lt;- -2 * x + rnorm(100, sd = 1)
y_high &lt;- -2 * x + rnorm(100, sd = 3)
df &lt;- data.frame(x, y_low, y_med, y_high) %&gt;% 
  gather(key=&quot;variability&quot;, value=y, -x)
df$variability &lt;- fct_relevel(factor(df$variability), &quot;y_low&quot;, &quot;y_med&quot;, &quot;y_high&quot;)
ggplot(df, aes(x,y)) + 
  geom_point() +
  facet_wrap(~variability)</code></pre>
<p><img src="figure/lecture7.Rmd/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;" /></p>
<details> <summary><em>Expand here to see past versions of unnamed-chunk-7-1.png:</em></summary>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/figure/lecture7.Rmd/unnamed-chunk-7-1.png" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
</tr>
</tbody>
</table>
<p></details></p>
<pre class="r"><code>df %&gt;% group_by(variability) %&gt;%
  summarize(cor = cor(x,y))</code></pre>
<pre><code># A tibble: 3 x 2
  variability    cor
  &lt;fct&gt;        &lt;dbl&gt;
1 y_low       -0.981
2 y_med       -0.908
3 y_high      -0.624</code></pre>
<pre class="r"><code>## Can perform hypothesis testing with correlations
cor.test(setosa$Sepal.Length, setosa$Sepal.Width)</code></pre>
<pre><code>
    Pearson&#39;s product-moment correlation

data:  setosa$Sepal.Length and setosa$Sepal.Width
t = 7.6807, df = 48, p-value = 6.71e-10
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.5851391 0.8460314
sample estimates:
      cor 
0.7425467 </code></pre>
<pre class="r"><code>## How do we interpret this output?</code></pre>
<pre class="r"><code>cor.test(setosa$Petal.Length, setosa$Sepal.Width)</code></pre>
<pre><code>
    Pearson&#39;s product-moment correlation

data:  setosa$Petal.Length and setosa$Sepal.Width
t = 1.2511, df = 48, p-value = 0.217
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.1058851  0.4345536
sample estimates:
   cor 
0.1777 </code></pre>
<pre class="r"><code>## How about this?</code></pre>
<pre class="r"><code>## What about nonlinear data? =&gt; Spearman rank nonparametric correlation!
## Assumes monotonic data
x &lt;- seq(from=0.001, to=10, length=100)
y &lt;- exp(x) + rnorm(length(x), sd = 100)
ggplot(data.frame(x,y), aes(x=x,y=y)) +
  geom_point() + 
  geom_smooth(method=&quot;lm&quot;, se=FALSE)</code></pre>
<p><img src="figure/lecture7.Rmd/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;" /></p>
<details> <summary><em>Expand here to see past versions of unnamed-chunk-10-1.png:</em></summary>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/figure/lecture7.Rmd/unnamed-chunk-10-1.png" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
</tr>
</tbody>
</table>
<p></details></p>
<pre class="r"><code>cor(x,y)</code></pre>
<pre><code>[1] 0.6898587</code></pre>
<pre class="r"><code>cor(x,y, method=&quot;spearman&quot;)</code></pre>
<pre><code>[1] 0.9150795</code></pre>
<pre class="r"><code>cor(order(x), order(y)) ## Same as Pearson correlation on ranks </code></pre>
<pre><code>[1] 0.9150795</code></pre>
<pre class="r"><code>#-------------------------------------------------------------
## Calculate the Pearson and Spearman correlation between
## carat and price in the diamonds data for cut = &quot;Ideal&quot; diamonds.
## Which one is best suited to these data?
#-------------------------------------------------------------

data(diamonds)
diamonds %&gt;% filter(cut == &quot;Ideal&quot;) %&gt;%
  summarize(pearson = cor(carat, price),
            spearman = cor(carat, price, method=&quot;spearman&quot;))</code></pre>
<pre><code># A tibble: 1 x 2
  pearson spearman
    &lt;dbl&gt;    &lt;dbl&gt;
1   0.931    0.954</code></pre>
<pre class="r"><code>ggplot(filter(diamonds, cut == &quot;Ideal&quot;)) + 
  geom_point(aes(y=price, x=carat))</code></pre>
<p><img src="figure/lecture7.Rmd/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>
<details> <summary><em>Expand here to see past versions of unnamed-chunk-11-1.png:</em></summary>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/figure/lecture7.Rmd/unnamed-chunk-11-1.png" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
</tr>
</tbody>
</table>
<p></details></p>
</div>
<div id="linear-regression" class="section level2">
<h2>Linear regression</h2>
<pre class="r"><code>#=============================================================
## Linear regression
##
## We use linear models to ask how various predictors affect, or to 
##   what extent a set of predictors can explain, a numeric response. 
##   The goal of linear modeling is to be able to predict the numeric 
##   response from explanatory variables.
##
## Least squares: find line of &quot;best fit&quot; that minimizes sum
##   of squared residuals
##
## lm(Y ~ X, data = &lt;data frame&gt;)
#=============================================================

## Just having the correlation is not always enough
## e.g., sometimes we want to be able to predict, etc.

ggplot(setosa, aes(x=Sepal.Width, y=Sepal.Length)) +
  geom_point() +
  geom_smooth(method=&quot;lm&quot;, se=FALSE)</code></pre>
<p><img src="figure/lecture7.Rmd/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;" /></p>
<details> <summary><em>Expand here to see past versions of unnamed-chunk-12-1.png:</em></summary>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/figure/lecture7.Rmd/unnamed-chunk-12-1.png" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
</tr>
</tbody>
</table>
<p></details></p>
<pre class="r"><code>mod  &lt;- lm(Sepal.Length ~ Sepal.Width, 
           data = setosa)
summary(mod)</code></pre>
<pre><code>
Call:
lm(formula = Sepal.Length ~ Sepal.Width, data = setosa)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.52476 -0.16286  0.02166  0.13833  0.44428 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   2.6390     0.3100   8.513 3.74e-11 ***
Sepal.Width   0.6905     0.0899   7.681 6.71e-10 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 0.2385 on 48 degrees of freedom
Multiple R-squared:  0.5514,    Adjusted R-squared:  0.542 
F-statistic: 58.99 on 1 and 48 DF,  p-value: 6.71e-10</code></pre>
<pre class="r"><code>## What are the conclusions of the linear model?

## (Intercept):
## Sepal.Width:
## Estimate/Std. Error/t value/Pr(&gt;|t|):
## Residual standard error:
## Multiple R-squared, adjusted R-squared:
## F-statistic:</code></pre>
<pre class="r"><code>## broom is a package that tidies results from a linear model / hypothesis tests
## 3 functions: tidy(), glance(), augment()
library(broom)
tidy(mod)    ## Coefficients and p-values</code></pre>
<pre><code># A tibble: 2 x 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)    2.64     0.310       8.51 3.74e-11
2 Sepal.Width    0.690    0.0899      7.68 6.71e-10</code></pre>
<pre class="r"><code>glance(mod)  ## Concise one row summary</code></pre>
<pre><code># A tibble: 1 x 11
  r.squared adj.r.squared sigma statistic  p.value    df logLik   AIC   BIC
*     &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     0.551         0.542 0.239      59.0 6.71e-10     2   1.73  2.53  8.27
# ... with 2 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;</code></pre>
<pre class="r"><code>augment(mod) ## Add columns from fit to original data that were modeled</code></pre>
<pre><code># A tibble: 50 x 9
   Sepal.Length Sepal.Width .fitted .se.fit  .resid   .hat .sigma .cooksd
 *        &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
 1          5.1         3.5    5.06  0.0344  0.0443 0.0207  0.241 3.73e-4
 2          4.9         3      4.71  0.0512  0.190  0.0460  0.239 1.60e-2
 3          4.7         3.2    4.85  0.0395 -0.149  0.0274  0.240 5.61e-3
 4          4.6         3.1    4.78  0.0448 -0.180  0.0353  0.240 1.07e-2
 5          5           3.6    5.12  0.0371 -0.125  0.0242  0.240 3.48e-3
 6          5.4         3.9    5.33  0.0542  0.0681 0.0516  0.241 2.34e-3
 7          4.6         3.4    4.99  0.0338 -0.387  0.0201  0.234 2.75e-2
 8          5           3.4    4.99  0.0338  0.0133 0.0201  0.241 3.27e-5
 9          4.4         2.9    4.64  0.0582 -0.241  0.0596  0.238 3.45e-2
10          4.9         3.1    4.78  0.0448  0.120  0.0353  0.240 4.84e-3
# ... with 40 more rows, and 1 more variable: .std.resid &lt;dbl&gt;</code></pre>
<pre class="r"><code>## Visualizing the regression
ggplot(setosa, aes(x=Sepal.Width, y=Sepal.Length)) +
  geom_point() + 
  geom_smooth(method=&quot;lm&quot;) +
  geom_text(x = 2.75, y = 5.5, label = &quot;y = 2.639 + 0.69x&quot;, color=&quot;red&quot;)  +
  theme_bw()</code></pre>
<p><img src="figure/lecture7.Rmd/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;" /></p>
<details> <summary><em>Expand here to see past versions of unnamed-chunk-14-1.png:</em></summary>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/figure/lecture7.Rmd/unnamed-chunk-14-1.png" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
</tr>
</tbody>
</table>
<p></details></p>
<pre class="r"><code>## Predicting responses using the model
## What is the Sepal.Length when Sepal.Width = 2.6?
new_setosa &lt;- data.frame(Sepal.Width = c(2.6, 4, 3.5))
predict(mod, new_setosa)</code></pre>
<pre><code>       1        2        3 
4.434275 5.400960 5.055715 </code></pre>
<pre class="r"><code>## Predicting a new response with confidence or prediction interval
## Confidence interval: range likely to contain the mean response
predict(mod, new_setosa, interval = &quot;confidence&quot;)</code></pre>
<pre><code>       fit      lwr      upr
1 4.434275 4.269957 4.598592
2 5.400960 5.277305 5.524615
3 5.055715 4.986649 5.124781</code></pre>
<pre class="r"><code>## Prediction interval: range likely to contain the response value of
##   a single new observation (wider than CI due to added uncertainty
##   for predicting a single point)
predict(mod, new_setosa, interval = &quot;predict&quot;)</code></pre>
<pre><code>       fit      lwr      upr
1 4.434275 3.927287 4.941262
2 5.400960 4.905655 5.896265
3 5.055715 4.571147 5.540284</code></pre>
<pre class="r"><code>predict(mod, new_setosa, interval = &quot;confidence&quot;, level=0.90)</code></pre>
<pre><code>       fit      lwr      upr
1 4.434275 4.297205 4.571344
2 5.400960 5.297810 5.504110
3 5.055715 4.998102 5.113328</code></pre>
</div>
<div id="checking-model-assumptions" class="section level2">
<h2>Checking model assumptions</h2>
<pre class="r"><code>## 1. Residuals are normally distributed
## 2. Variance is the same for all predictors
## 3. Predictors are independent of one another
## 4. Relationship between response and predictors is linear
## 
## How do we check each of these assumptions?

#-------------------------------------------------------------
## Graphically check assumptions 1,2,4 for the setosa data
#-------------------------------------------------------------

aug &lt;- augment(mod)
resids &lt;- residuals(mod)
fitted &lt;- fitted(mod)

## Assumption 1
ggplot(aug) + geom_histogram(aes(x=.resid),
                             bins=15)</code></pre>
<p><img src="figure/lecture7.Rmd/unnamed-chunk-18-1.png" width="672" style="display: block; margin: auto;" /></p>
<details> <summary><em>Expand here to see past versions of unnamed-chunk-18-1.png:</em></summary>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/figure/lecture7.Rmd/unnamed-chunk-18-1.png" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
</tr>
</tbody>
</table>
<p></details></p>
<pre class="r"><code>ggplot(aug) + geom_qq(aes(sample=.resid))</code></pre>
<p><img src="figure/lecture7.Rmd/unnamed-chunk-18-2.png" width="672" style="display: block; margin: auto;" /></p>
<details> <summary><em>Expand here to see past versions of unnamed-chunk-18-2.png:</em></summary>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/figure/lecture7.Rmd/unnamed-chunk-18-2.png" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
</tr>
</tbody>
</table>
<p></details></p>
<pre class="r"><code>## Assumption 2
ggplot(aug) + geom_point(aes(x=.fitted, y=.resid)) +
  geom_hline(yintercept=0, lty=2)</code></pre>
<p><img src="figure/lecture7.Rmd/unnamed-chunk-19-1.png" width="672" style="display: block; margin: auto;" /></p>
<details> <summary><em>Expand here to see past versions of unnamed-chunk-19-1.png:</em></summary>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/figure/lecture7.Rmd/unnamed-chunk-19-1.png" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
</tr>
</tbody>
</table>
<p></details></p>
<pre class="r"><code>## Assumption 4
ggplot(aug) + geom_point(aes(x=Sepal.Width, y=Sepal.Length))</code></pre>
<p><img src="figure/lecture7.Rmd/unnamed-chunk-20-1.png" width="672" style="display: block; margin: auto;" /></p>
<details> <summary><em>Expand here to see past versions of unnamed-chunk-20-1.png:</em></summary>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/figure/lecture7.Rmd/unnamed-chunk-20-1.png" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
</tr>
</tbody>
</table>
<p></details></p>
</div>
<div id="matrix-algebra" class="section level2">
<h2>Matrix algebra</h2>
<pre class="r"><code>#=============================================================
## A quick break: Matrix algebra in R
#=============================================================

## Creating a couple of matrices
x1 &lt;- c(3,4,5,6)
x2 &lt;- c(10,11,12,13)
x3 &lt;- c(-1, -2, -3, -4)
A &lt;- cbind(x1, x2, x3)
B &lt;- rbind(x1, x2, x3)

## Reminder about extracting elements from matrices
A[1,3]  ## pulls element in row1, column3 of A</code></pre>
<pre><code>x3 
-1 </code></pre>
<pre class="r"><code>A[,1]   ## pulls first column</code></pre>
<pre><code>[1] 3 4 5 6</code></pre>
<pre class="r"><code>A[1,]</code></pre>
<pre><code>x1 x2 x3 
 3 10 -1 </code></pre>
<pre class="r"><code>A[2,2:3]</code></pre>
<pre><code>x2 x3 
11 -2 </code></pre>
<pre class="r"><code>A[2, c(1,3)]</code></pre>
<pre><code>x1 x3 
 4 -2 </code></pre>
<pre class="r"><code>## Recall how multiplication/addition in R are done element-wise
A * B # not working 
A + B</code></pre>
<pre class="r"><code>## If we are after &quot;classic&quot; matrix multiplication, we have to do as follows:
A %*% B</code></pre>
<pre><code>     [,1] [,2] [,3] [,4]
[1,]  110  124  138  152
[2,]  124  141  158  175
[3,]  138  158  178  198
[4,]  152  175  198  221</code></pre>
<pre class="r"><code>B %*% A</code></pre>
<pre><code>    x1   x2   x3
x1  86  212  -50
x2 212  534 -120
x3 -50 -120   30</code></pre>
<pre class="r"><code>## What is the difference between the two following operations?
x1*x2</code></pre>
<pre><code>[1] 30 44 60 78</code></pre>
<pre class="r"><code>x1 %*% x2</code></pre>
<pre><code>     [,1]
[1,]  212</code></pre>
<pre class="r"><code>## What happens when we transpose a matrix?
t(A) + B</code></pre>
<pre><code>   [,1] [,2] [,3] [,4]
x1    6    8   10   12
x2   20   22   24   26
x3   -2   -4   -6   -8</code></pre>
<pre class="r"><code>A - t(B)</code></pre>
<pre><code>     x1 x2 x3
[1,]  0  0  0
[2,]  0  0  0
[3,]  0  0  0
[4,]  0  0  0</code></pre>
<pre class="r"><code>## We can take the inverse of a square matrix
A = rbind(c(-1,4), c(3,6))
c = c(8,30)
x = solve(A,c)

#### This basically finds x, such that Ax=c
#### Let&#39;s doubl check
A %*% x</code></pre>
<pre><code>     [,1]
[1,]    8
[2,]   30</code></pre>
<pre class="r"><code>#### We can also use the solve function to find the inverse of a matrix
A.inv = solve(A)

#### Check
A.inv %*% A</code></pre>
<pre><code>     [,1]         [,2]
[1,]    1 2.220446e-16
[2,]    0 1.000000e+00</code></pre>
<pre class="r"><code>A %*% A.inv</code></pre>
<pre><code>     [,1]          [,2]
[1,]    1 -2.775558e-17
[2,]    0  1.000000e+00</code></pre>
<pre class="r"><code>### Note the rounding errors!</code></pre>
<pre class="r"><code>### Recall linear regression
### If our model is Y = XB + e, then beta.hat = inverse(X&#39;X)X&#39;Y
x1 &lt;- rep(1, times=10)
x2 &lt;- 1:10
X &lt;- cbind(x1, x2)
y &lt;- x2 + rnorm(10)
beta.hat = solve(t(X) %*% X) %*% t(X) %*% y

## Double-check this is the same with lm!
summary(lm(y ~ x2))</code></pre>
<pre><code>
Call:
lm(formula = y ~ x2)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.0031 -0.5715  0.1347  0.4851  0.9279 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -1.49711    0.52237  -2.866    0.021 *  
x2           1.20681    0.08419  14.335 5.47e-07 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 0.7647 on 8 degrees of freedom
Multiple R-squared:  0.9625,    Adjusted R-squared:  0.9578 
F-statistic: 205.5 on 1 and 8 DF,  p-value: 5.475e-07</code></pre>
<pre class="r"><code>beta.hat</code></pre>
<pre><code>        [,1]
x1 -1.497112
x2  1.206807</code></pre>
<pre class="r"><code>## And double-check with a plot
plot(x2, y, pch=20, cex=3)
abline(beta.hat[1], beta.hat[2])</code></pre>
<p><img src="figure/lecture7.Rmd/unnamed-chunk-29-1.png" width="672" style="display: block; margin: auto;" /></p>
<details> <summary><em>Expand here to see past versions of unnamed-chunk-29-1.png:</em></summary>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/figure/lecture7.Rmd/unnamed-chunk-29-1.png" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
</tr>
</tbody>
</table>
<p></details></p>
<pre class="r"><code>#### Do you remeber the form of var(beta.hat)?
#### The diagonal elements of sigma^2 * inverse(X&#39;X) 
#### How do we estimate sigma^2? (Y-y.hat)&#39;(Y-y.hat)/n-p

y.hat &lt;- X %*% beta.hat
sigma.2 &lt;- t(y - y.hat) %*% (y-y.hat)/(10-2)

Var.Cov.beta &lt;- as.numeric(sigma.2) * solve(t(X) %*% X)
se.beta1.hat &lt;- sqrt(Var.Cov.beta[2,2])
se.beta0.hat &lt;- sqrt(Var.Cov.beta[1,1])

my_linear_regression &lt;- function(y, X) {
  n &lt;- length(y)
  p &lt;- dim(X)[2]
  beta.hat &lt;- solve(t(X) %*% X) %*% t(X) %*% y
  y.hat &lt;- X %*% beta.hat
  sigma.2 &lt;- t(y - y.hat) %*% (y-y.hat)/(n-p)
  Var.Cov.beta &lt;- as.numeric(sigma.2) * solve(t(X) %*% X)
  se.beta1.hat &lt;- sqrt(Var.Cov.beta[2,2])
  se.beta0.hat &lt;- sqrt(Var.Cov.beta[1,1])
  return(list(beta.hat=beta.hat, se0=se.beta0.hat, se1=se.beta1.hat))
}

## Now check that they match!
y.sim &lt;- rnorm(1000)
X.sim &lt;- cbind(rep(1, times=1000), c(rep(0, times=500), rep(1, times=500))) 
my_linear_regression(y.sim, X.sim)</code></pre>
<pre><code>$beta.hat
            [,1]
[1,] -0.06510661
[2,] -0.02439115

$se0
[1] 0.04488844

$se1
[1] 0.06348184</code></pre>
<pre class="r"><code>lm(y.sim ~ 0 + X.sim)</code></pre>
<pre><code>
Call:
lm(formula = y.sim ~ 0 + X.sim)

Coefficients:
  X.sim1    X.sim2  
-0.06511  -0.02439  </code></pre>
<pre class="r"><code>lm(y.sim ~ X.sim[,2])</code></pre>
<pre><code>
Call:
lm(formula = y.sim ~ X.sim[, 2])

Coefficients:
(Intercept)   X.sim[, 2]  
   -0.06511     -0.02439  </code></pre>
<pre class="r"><code>#=============================================================
## Linear models: lm(Numeric response ~ &lt;predictors&gt;)
## 
## Single numeric predictor = Regression
## Single categorical predictor = ANOVA
## Multiple numeric predictors = Multiple regression
## Multiple categorical predictors = n-way ANOVA
## Single categorical and n numeric predictors = ANCOVA
## Multiple categorical and n numeric predictors = linear model
#=============================================================

## What happens with a categorical predictor?
mod_species &lt;- lm(Sepal.Length ~ Species, data=iris)
summary(mod_species) ## Where is the Speciessetosa coefficient?</code></pre>
<pre><code>
Call:
lm(formula = Sepal.Length ~ Species, data = iris)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.6880 -0.3285 -0.0060  0.3120  1.3120 

Coefficients:
                  Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         5.0060     0.0728  68.762  &lt; 2e-16 ***
Speciesversicolor   0.9300     0.1030   9.033 8.77e-16 ***
Speciesvirginica    1.5820     0.1030  15.366  &lt; 2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 0.5148 on 147 degrees of freedom
Multiple R-squared:  0.6187,    Adjusted R-squared:  0.6135 
F-statistic: 119.3 on 2 and 147 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>augment_species &lt;- augment(mod_species)
ggplot(augment_species, aes(x=Species, y=Sepal.Length)) +
         geom_point() +
  geom_point(aes(x=Species, y=.fitted), color=&quot;red&quot;, size=4)</code></pre>
<p><img src="figure/lecture7.Rmd/unnamed-chunk-32-1.png" width="672" style="display: block; margin: auto;" /></p>
<details> <summary><em>Expand here to see past versions of unnamed-chunk-32-1.png:</em></summary>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/figure/lecture7.Rmd/unnamed-chunk-32-1.png" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
</tr>
</tbody>
</table>
<p></details></p>
<pre class="r"><code>## Interactions: continuous and categorical
ggplot(iris, aes(x=Sepal.Length, y=Sepal.Width)) +
  geom_point(aes(color=Species))</code></pre>
<p><img src="figure/lecture7.Rmd/unnamed-chunk-33-1.png" width="672" style="display: block; margin: auto;" /></p>
<details> <summary><em>Expand here to see past versions of unnamed-chunk-33-1.png:</em></summary>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/figure/lecture7.Rmd/unnamed-chunk-33-1.png" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
</tr>
</tbody>
</table>
<p></details></p>
<pre class="r"><code>mod1 &lt;- lm(Sepal.Width ~ Sepal.Length + Species, data=iris)
mod2 &lt;- lm(Sepal.Width ~ Sepal.Length * Species, data=iris)</code></pre>
<pre class="r"><code>## Use commands from modelr
library(modelr)</code></pre>
<pre><code>
Attaching package: &#39;modelr&#39;</code></pre>
<pre><code>The following object is masked from &#39;package:broom&#39;:

    bootstrap</code></pre>
<pre class="r"><code>grid &lt;- data_grid(iris, Sepal.Length, Sepal.Width, Species) %&gt;%
  gather_predictions(mod1, mod2)
ggplot(iris, aes(x=Sepal.Length, y=Sepal.Width, colour = Species)) + 
  geom_point() + 
  geom_line(data = grid, aes(y = pred)) + 
  facet_wrap(~ model) + theme_bw()</code></pre>
<p><img src="figure/lecture7.Rmd/unnamed-chunk-34-1.png" width="672" style="display: block; margin: auto;" /></p>
<details> <summary><em>Expand here to see past versions of unnamed-chunk-34-1.png:</em></summary>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/figure/lecture7.Rmd/unnamed-chunk-34-1.png" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
</tr>
</tbody>
</table>
<p></details></p>
<pre class="r"><code>res &lt;- iris %&gt;% gather_residuals(mod1, mod2)
ggplot(res, aes(x=Sepal.Length, y=resid, colour = Species)) + 
  geom_point() + 
  facet_grid(model ~ Species)</code></pre>
<p><img src="figure/lecture7.Rmd/unnamed-chunk-34-2.png" width="672" style="display: block; margin: auto;" /></p>
<details> <summary><em>Expand here to see past versions of unnamed-chunk-34-2.png:</em></summary>
<table style="border-collapse:separate; border-spacing:5px;">
<thead>
<tr>
<th style="text-align:left;">
Version
</th>
<th style="text-align:left;">
Author
</th>
<th style="text-align:left;">
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://github.com/han16/Data-Science-in-R/blob/43c8686867d5fd189a1aac98b3cf93262f8058d9/docs/figure/lecture7.Rmd/unnamed-chunk-34-2.png" target="_blank">43c8686</a>
</td>
<td style="text-align:left;">
Shengtong
</td>
<td style="text-align:left;">
2018-11-06
</td>
</tr>
</tbody>
</table>
<p></details></p>
<pre class="r"><code>## Reminder: we can always check the model matrix to see the equation fit by lm!
model_matrix(iris, Sepal.Length ~ Species)</code></pre>
<pre><code># A tibble: 150 x 3
   `(Intercept)` Speciesversicolor Speciesvirginica
           &lt;dbl&gt;             &lt;dbl&gt;            &lt;dbl&gt;
 1             1                 0                0
 2             1                 0                0
 3             1                 0                0
 4             1                 0                0
 5             1                 0                0
 6             1                 0                0
 7             1                 0                0
 8             1                 0                0
 9             1                 0                0
10             1                 0                0
# ... with 140 more rows</code></pre>
<pre class="r"><code>## For a true confirmatory analysis:
## Training set (60%), query set (20%), test set (20%)


#=============================================================
## Next time: Midterm! Class cancelled
## Following that: logistic regression, model selection, multiple testing
#=============================================================</code></pre>
</div>
<div id="session-information" class="section level2">
<h2>Session information</h2>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>R version 3.5.1 (2018-07-02)
Platform: x86_64-apple-darwin15.6.0 (64-bit)
Running under: macOS High Sierra 10.13.6

Matrix products: default
BLAS: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRblas.0.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] modelr_0.1.2    broom_0.5.0     bindrcpp_0.2.2  forcats_0.3.0  
 [5] stringr_1.3.1   dplyr_0.7.7     purrr_0.2.5     readr_1.1.1    
 [9] tidyr_0.8.2     tibble_1.4.2    ggplot2_3.1.0   tidyverse_1.2.1

loaded via a namespace (and not attached):
 [1] tidyselect_0.2.5  reshape2_1.4.3    haven_1.1.2      
 [4] lattice_0.20-35   colorspace_1.3-2  htmltools_0.3.6  
 [7] yaml_2.2.0        utf8_1.1.4        rlang_0.3.0.1    
[10] R.oo_1.22.0       pillar_1.3.0      glue_1.3.0       
[13] withr_2.1.2       R.utils_2.7.0     readxl_1.1.0     
[16] bindr_0.1.1       plyr_1.8.4        munsell_0.5.0    
[19] gtable_0.2.0      workflowr_1.1.1   cellranger_1.1.0 
[22] rvest_0.3.2       R.methodsS3_1.7.1 evaluate_0.12    
[25] labeling_0.3      knitr_1.20        fansi_0.4.0      
[28] Rcpp_0.12.19      scales_1.0.0      backports_1.1.2  
[31] jsonlite_1.5      hms_0.4.2         digest_0.6.18    
[34] stringi_1.2.4     grid_3.5.1        rprojroot_1.3-2  
[37] cli_1.0.1         tools_3.5.1       magrittr_1.5     
[40] lazyeval_0.2.1    crayon_1.3.4      whisker_0.3-2    
[43] pkgconfig_2.0.2   xml2_1.2.0        lubridate_1.7.4  
[46] assertthat_0.2.0  rmarkdown_1.10    httr_1.3.1       
[49] rstudioapi_0.8    R6_2.3.0          nlme_3.1-137     
[52] git2r_0.23.0      compiler_3.5.1   </code></pre>
</div>

<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
http://docs.mathjax.org/en/latest/configuration.html.  This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>

<hr>
<p>
  This reproducible <a href="http://rmarkdown.rstudio.com">R Markdown</a>
  analysis was created with
  <a href="https://github.com/jdblischak/workflowr">workflowr</a> 1.1.1
</p>
<hr>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
